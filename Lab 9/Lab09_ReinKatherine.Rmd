---
title: "ReinKatherine_Lab09"
output: html_document
date: "2024-03-29"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Questions

- Need to understand 7
- Very confused on 8


## Import Data

```{r}
data <- read.csv("World_Development_Indicators.csv", na.strings = "#N/A")

# Clean Data
new_labels = c("Country.Code","CO2","GDP","GasPrice", "ProtectedAreas", "PopulationDensity",
                 "Precipitation", "ArableLand")
column_names = c("Country.Code","EN.ATM.CO2E.PC", "NY.GDP.PCAP.CD", "EP.PMP.SGAS.CD", "ER.PTD.TOTL.ZS",
                 "EN.POP.DNST", "AG.LND.PRCP.MM", "AG.LND.ARBL.HA.PC")

data <- data[,column_names]
names(data) <- new_labels
```

## Step 5: Check for Colinearity

```{r}
xvariables = c("GDP","GasPrice", "ProtectedAreas", "PopulationDensity",
                 "Precipitation", "ArableLand")
pairs_sub = data[,xvariables]

pairs(pairs_sub)
cor(pairs_sub, use = "pairwise.complete.obs")

data2 = na.omit(data[,c("Country.Code", "CO2", xvariables)])
```

The only two x variables that seem correlated even slightly are GDP and Population Density. However, visually they don't look correlated so I will keep them both in.

## Step 6: Multivariate analyses and model selection

```{r}
## 1 Variable
# From Lab 8
fit_GDP = lm(CO2 ~ GDP, data2)
summary(fit_GDP)
our_aic = AIC(fit_GDP)
print(our_aic)
```
```{r}
## 2 Variables

# Gas Price
fit_GDP_Gas = lm(CO2 ~ GDP + GasPrice,data2)
summary(fit_GDP_Gas)
our_aic = AIC(fit_GDP_Gas)
print(our_aic)

# Protected Areas
fit_GDP_PA = lm(CO2 ~ GDP + ProtectedAreas,data2)
summary(fit_GDP_PA)
our_aic = AIC(fit_GDP_PA)
print(our_aic)

# Population Density
fit_GDP_PD = lm(CO2 ~ GDP + PopulationDensity,data2)
summary(fit_GDP_PD)
our_aic = AIC(fit_GDP_PD)
print(our_aic)

# Precipitation
fit_GDP_Prec = lm(CO2 ~ GDP + Precipitation,data2)
summary(fit_GDP_Prec)
our_aic = AIC(fit_GDP_Prec)
print(our_aic)

# Arable Land
fit_GDP_AL = lm(CO2 ~ GDP + ArableLand,data2)
summary(fit_GDP_AL)
our_aic = AIC(fit_GDP_AL)
print(our_aic)

```
```{r}
## 3 Variables

# GDP, Gas Price, Protected Areas
fit_GDP_Gas_PA = lm(CO2 ~ GDP + GasPrice + ProtectedAreas,data2)
summary(fit_GDP_Gas_PA)
our_aic = AIC(fit_GDP_Gas_PA)
print(our_aic)

# GDP, Gas Price, Population Density
fit_GDP_Gas_PD = lm(CO2 ~ GDP + GasPrice + PopulationDensity,data2)
summary(fit_GDP_Gas_PD)
our_aic = AIC(fit_GDP_Gas_PD)
print(our_aic)

# GDP, Gas Price, Precipitation
fit_GDP_Gas_Prec = lm(CO2 ~ GDP + GasPrice + Precipitation,data2)
summary(fit_GDP_Gas_Prec)
our_aic = AIC(fit_GDP_Gas_Prec)
print(our_aic)

# GDP, Gas Price, Arable Land
fit_GDP_Gas_AL = lm(CO2 ~ GDP + GasPrice + ArableLand,data2)
summary(fit_GDP_Gas_AL)
our_aic = AIC(fit_GDP_Gas_AL)
print(our_aic)

```
```{r}
## 4 Variables

# GDP, Gas Price, Arable Land, Protected Areas
fit_GDP_Gas_AL_PA = lm(CO2 ~ GDP + GasPrice + ArableLand + ProtectedAreas,data2)
summary(fit_GDP_Gas_AL_PA)
our_aic = AIC(fit_GDP_Gas_AL_PA)
print(our_aic)

# GDP, Gas Price, Arable Land, Population Density
fit_GDP_Gas_AL_PD = lm(CO2 ~ GDP + GasPrice + ArableLand + PopulationDensity,data2)
summary(fit_GDP_Gas_AL_PD)
our_aic = AIC(fit_GDP_Gas_AL_PD)
print(our_aic)

# GDP, Gas Price, Arable Land, Precipitation
fit_GDP_Gas_AL_Prec = lm(CO2 ~ GDP + GasPrice + ArableLand + Precipitation,data2)
summary(fit_GDP_Gas_AL_Prec)
our_aic = AIC(fit_GDP_Gas_AL_Prec)
print(our_aic)

```

```{r}
## 5 Variables

# GDP, Gas Price, Arable Land, Precipitation, Protected Areas
fit_GDP_Gas_PD_Prec_PA = lm(CO2 ~ GDP + GasPrice + ArableLand + Precipitation + ProtectedAreas ,data2)
summary(fit_GDP_Gas_PD_Prec_PA)
our_aic = AIC(fit_GDP_Gas_PD_Prec_PA)
print(our_aic)

# GDP, Gas Price, Arable Land, Precipitation, Population Density
fit_GDP_Gas_PD_Prec_PD = lm(CO2 ~ GDP + GasPrice + ArableLand + Precipitation + PopulationDensity,data2)
summary(fit_GDP_Gas_PD_Prec_PD)
our_aic = AIC(fit_GDP_Gas_PD_Prec_PD)
print(our_aic)

```

```{r}
## Best Model

AICtable = data.frame(model = 1:5, AIC = c(AIC(fit_GDP), AIC(fit_GDP_Gas), AIC(fit_GDP_Gas_AL),
                                           AIC(fit_GDP_Gas_AL_Prec), 
                                           AIC(fit_GDP_Gas_PD_Prec_PA)))

AICtable$dAIC = AICtable$AIC - min(AICtable$AIC)

knitr::kable(AICtable)

```


Choosing the best model from this analysis is a bit confusing. My best model when looking at AIC is a 4 variable model that uses GDP, Gas Price, Arable Land, and Precipitation. However, Arable Land and Precipitation are not statistically significant based on their p values. Personally, I would choose the 4 variable model but it is still just as good of a choice to use the 2 variable model.

## Step 7: Model Assessment

```{r}
# Best Model: fit_GDP_Gas_AL_Prec

## Predicted vs Observed

plot(predict(fit_GDP_Gas_AL_Prec),data2$CO2, pch = 19, cex = 0.7, xlab = "Predicted Values", ylab = "Observed Values", main = "Observed vs. Predicted CO2 Values")

# Add a 1:1 line
abline(a = 0, b = 1, col = "red")

## Diagnostic Plots

plot(fit_GDP_Gas_AL_Prec)

```
Based on the predicted vs observed graph, my model is good. The predicted and observed values are colinear. This means that the values I predicted are similar to the observed values.

Based on the Q-Q plot, the model behaves similarly to a normal distribution. This is because it is mostly along the dotted line. 


## Step 8: Making Predictions

```{r}
# Best Model: fit_GDP_Gas_AL_Prec
# Univariate Model: fit_GDP

## Univariate
# CI and PI
Tpred = data.frame(GDP=seq(0,200000, by = 10000))

CI = as.data.frame(predict(fit_GDP,newdata = Tpred,interval="confidence"))
PI = as.data.frame(predict(fit_GDP,newdata = Tpred,interval="prediction")) 

# Graph
plot(data2$GDP,data2$CO2, xlab = "GDP", ylab = "CO2", main = "GDP vs CO2", pch = 19, cex = 0.7)

abline(fit_GDP,col=2,lwd=4)

lines(Tpred$GDP,CI$lwr,col=2,lty=2)
lines(Tpred$GDP,CI$upr,col=2,lty =2)

lines(Tpred$GDP,PI$lwr,col=4,lty=2,lwd=3)
lines(Tpred$GDP,PI$upr,col=4,lty=2,lwd=3)

legend("topleft",
       legend = c("Regression Line", "95% Confidence Interval", "95% Prediction Interval"),
       col = c(2, 2, 4),
       lty = c(1, 2, 2),
       lwd = c(4, 1, 3))

## Multivariate
# CI and PI
country = "DNK"
years = 1:25
r = 0.1 # % per year
AL = data2[data2$Country.Code == country, "ArableLand"]

Tpred1 = data.frame(GDP = rep(data2$GDP[data2$Country.Code == country], 25),
                    GasPrice = rep(data2$GasPrice[data2$Country.Code == country], 25),
                    Precipitation = rep(data2$Precipitation[data2$Country.Code == country], 25),
                    ArableLand = AL*(1+r)^years
)

CI1 = as.data.frame(predict(fit_GDP_Gas_AL_Prec,newdata = Tpred1,interval="confidence"))
PI1 = as.data.frame(predict(fit_GDP_Gas_AL_Prec,newdata = Tpred1,interval="prediction")) 

# Graph
plot(data2$ArableLand,data2$CO2, xlab = "Arable Land", ylab = "CO2", main = "Arable Land vs CO2", pch = 19, cex = 0.7)

abline(fit_GDP_Gas_AL_Prec,col=2,lwd=4)

lines(Tpred1$ArableLand,CI1$lwr,col=2,lty=2)
lines(Tpred1$ArableLand,CI1$upr,col=2,lty =2)

lines(Tpred1$ArableLand,PI1$lwr,col=4,lty=2,lwd=3)
lines(Tpred1$ArableLand,PI1$upr,col=4,lty=2,lwd=3)

legend("topleft",
       legend = c("Regression Line", "95% Confidence Interval", "95% Prediction Interval"),
       col = c(2, 2, 4),
       lty = c(1, 2, 2),
       lwd = c(4, 1, 3))


```


