---
title: "Lab 5"
output: html_document
---

##Part A

**A1.** Explain each of the variables and parameters (C, M, D, t, x) in the one dimensional diffusion equation, including general unit of measurement (i.e. units of mass, units of length, etc). (5%)

Parameters:
```{r}
M = 10 
D = 0.05 
```

Variables: 
```{r}
x = seq(0,2,.5)
Time = c(1,10,100,1000) 
C_matrix = matrix(NA,length(x),length(Time)) 
```

C: concentration of pollutant (grams/cm)
M: mass of material (grams)
D: diffusion constant (cm^2/s)
t: time since release (s)
x: distance from origin (cm)

**A2.** Fill in the values in your data table using the above equation. Hint: you will want to loop over both time and distance.

```{r}
# Initial Conditions
M = 10
D = 0.05

# Nested for loops that calculate the concentration
# Loops over the x vector for each time spot
# Adds to that spot in the matrix
# x is in the x spot and time is in the y spot
# x is rows and time is columns
for(i_Time in 1:length(Time)){
  for(i_x in 1:length(x)){
    C = (M/sqrt(4*pi*D*Time[i_Time]))*exp(-((x[i_x])^2/(4*D*Time[i_Time])))
    C_matrix[i_x,i_Time] <- C
  }
}
```

**A3.**  What are the correct units for the concentrations you calculated?

M = grams
D = cm^2/sec
t = sec

1) M/sqrt(D*t)
2) sqrt(D*t) = cm

grams/cm


**A4.**  Using your data table, create two graphs. Include your graphs in your report.

 a.	Concentration vs. distance for each of the time periods.
 
```{r}
plot(x = NULL,y = NULL, main = "Concentration vs. Distance of Infinite", ylab = "Concentration (g/cm)", xlab = "Distance from Origin (cm)", ylim = range(C_matrix[,1]), xlim = range(x))

for(time_spot in 1:length(Time)){
  lines(x, C_matrix[,time_spot], type = 'l', col = time_spot+1)
}

# Add legend
legend("topright",title = "Time (s)", legend = Time, col = 2:(length(x)+1), lty = 1)
```
 
 b.	Concentration vs. time for each of the distances. 
	Hint: you’ll want to include log=‘x’ as an argument to plot

```{r}
plot(x = NULL,y = NULL, main = "Concentration vs. Time for Infinite", ylab = "Concentration (g/cm)", xlab = "Time (s)", ylim = range(C_matrix[1,]), xlim = range(Time), log = 'x')

for(x_spot in 1:length(x)){
  lines(Time, C_matrix[x_spot,], type = 'l', col = x_spot+1)
}

# Add legend
legend("topright",title = "Distance (cm)", legend = x, col = 2:(length(x)+1), lty = 1)
```

**A5.**  Do the graphs look reasonable? Support your answer with the general trend(s) from each graph. Be sure to describe behavior at the extremes (i.e. highest/lowest times and distances).

This makes sense because as time increases then the concentration at all distances converge. This follows as the more time means more ability for mixing which will cause a similar concentration at all points along the tube.

For the distance graph, it makes sense as distance increases, the concentration reaches a steady at all time steps. This follows as the concentration steadies out the further away it gets from the source.

##Part B

B1.  Calculate the fluxes

1.	Create a new sequence of time values that are now evenly spaced from time t=0 to t=1000 seconds with a time step dt = 1 sec. Create a new matrix of all zeros to store this larger set of Concentrations.

2.	Initialize the value in the first row & first column (t=0, x=0) with the Concentration of pollutant released into the tube. Hint: you will need to convert the Mass released into the concentration in that grid cell.

3.	Set up a *for* loop over time, and then within this loop set up a second *for* loop over distance

4.	Within this double loop:
  4.1.	Calculate the *rate* of flux between each grid cell. Assume that there is no flux in or out at the ends of the tube. Hints: 1) don’t forget that the flux will occur in *both* directions. 2) This can be easier to implement if you calculate the gross fluxes in each direction explicitly, rather than the net flux. 3) don't forget about the boundary conditions - this could be handled with two if/else statements, one for when you're at the right boundary and the second for when you're at the left boundary.
  4.2.	Given the *rate* of flux, calculate the *amount* of pollutant that moves from one grid cell to the next over the specified **dt** and **dx**.
  4.3.	Calculate the new Concentration at the next time step given the Concentration currently in each grid cell *plus* the fluxes into the cell *minus* the fluxes out of the cell. Hint: don’t double count fluxes — the flux out of one cell *is* the flux into it’s neighbor .

```{r}
# Step 1

# Creating the new vectors
dt = 1
dx = 0.5
time_2=seq(0, 1000, dt)
x = seq(0,2,.5) # same x as Part A

# Set up new matrix
C_matrix2 = matrix(0,length(x),length(time_2))

# Initial Conditions
M = 10
D = 0.05

# Step 2

C_matrix2[1,1] = M/dx # grams/cm 

# Step 3

for(i_Time in 1:length(time_2)){
  for(i_x in 1:length(x)){
    if(i_x == 1){ # CASE 1 FLUX (the start of the tube)
      Flux.to.left = 0 # bc you are at the left and moving right
      Flux.from.left = 0  # bc you are at the left and moving right
      Flux.to.right = D*C_matrix2[i_x,i_Time]
      Flux.from.right = D*C_matrix2[i_x+1,i_Time]
    }else if(i_x == length(x)){ # CASE 2 FLUX (the end of the tube)
      Flux.to.left = D*C_matrix2[i_x,i_Time]
      Flux.from.left = D*C_matrix2[i_x-1,i_Time]
      Flux.to.right = 0 # bc you are at the right and no left movement
      Flux.from.right = 0 # bc you are at the right and no left movement
    }else{ # CASE 3 FLUX (in between the extremes)
      Flux.to.left = D*C_matrix2[i_x,i_Time]
      Flux.from.left = D*C_matrix2[i_x-1,i_Time]
      Flux.to.right = D*C_matrix2[i_x,i_Time]
      Flux.from.right = D*C_matrix2[i_x+1,i_Time]
    }
    
    # Update Concentration
    C_matrix2[i_x,i_Time+1] = C_matrix2[i_x,i_Time] +  (Flux.from.left + Flux.from.right)*(dt/dx) -     (Flux.to.left + Flux.to.right)*(dt/dx)
  }
}

```

**B2.** Create graphs equivalent to those in A4. 

Concentration vs distance at the times t = 1, 10, 100, and 1000.

```{r}
plot(x = NULL,y = NULL, main = "Concentration vs. Distance of Finite", ylab = "Concentration (g/cm)", xlab = "Distance from Origin (cm)", ylim = range(C_matrix2[,1]), xlim = range(x))

# Choose time steps
choose_time = c(1,10,100,1000)
colors_graph = c(2,3,4,5)
n = 1

# Draw lines
for(t_spot in choose_time){
  lines(x, C_matrix2[,t_spot], type = 'l', col = colors_graph[n])
  n = n+1
}

# Add legend
legend("topright",title = "Time (s)", legend = choose_time, col = colors_graph, lty = 1)
```

Concentration vs time at all locations.

```{r}

colors_graph = c(2,3,4,5,6)
n = 1

plot(time_2, C_matrix2[1,], type = "l", col = colors_graph[n], main = "Concentration vs. Time for Finite", ylab = "Concentration (g/cm)", xlab = "Time (s)", ylim = range(C_matrix2), log = "x")

n = n+1
for(x_spot in 2:length(x)){
  lines(time_2, C_matrix2[x_spot,], type = 'l', col = colors_graph[n])
  n = n+1
}

# Add legend
legend("topright",title = "Distance (cm)", legend = x, col = colors_graph, lty = 1)
```

**B3.** Create graphs that contain both the infinite tube calculation (Part A) and the finite tube calculations (Part B). To keep the number of lines from getting out of hand, only include 2 times in the Concentration vs distance plot and 2 distances in the Concentration vs time plot. (10)
```{r}
# Concentration vs Distance Graph

plot(x = NULL,y = NULL, main = "Concentration vs Distance (both)", ylab = "Concentration (g/cm)", xlab = "Distance from Origin (cm)", ylim = range(C_matrix), xlim = range(x))
colors_graph = c(2,3,4,5)

# Part A lines
lines(x, C_matrix[,2], type = 'l', col = 2)
lines(x, C_matrix[,3], type = 'l', col = 3)

# Part B lines
lines(x, C_matrix2[,11], type = 'l', col = 4)
lines(x, C_matrix2[,101], type = 'l', col = 5)

# Add legend
legend("topright",title = "Time (s)", legend = c(paste(Time[2], "Infinte"), paste(Time[2], "Infinte"), paste(time_2[11], "Finite"), paste(time_2[101], "Finite")), col = colors_graph, lty = 1)

# Concentration vs Plot
plot(Time, C_matrix[1,], main = "Concentration vs. Time (both)", ylab = "Concentration (g/cm)", xlab = "Time (s)", ylim = range(C_matrix), log = "x", type = 'l', col = 2)

# Part A lines
lines(Time, C_matrix[2,], type = 'l', col = 3)

# Part B lines
lines(time_2, C_matrix2[1,], type = 'l', col = 4)
lines(time_2, C_matrix2[2,], type = 'l', col = 5)

# Add legend
legend("topright", title = "Distance (cm)", legend = c(paste(x[1], "Infinte"), paste(x[2], "Infinte"), paste(x[1], "Finite"), paste(x[2], "Finite")), col = colors_graph, lty = 1)

```

**B4.** Describe and explain the differences between these plots and how they evolve over time and space.




