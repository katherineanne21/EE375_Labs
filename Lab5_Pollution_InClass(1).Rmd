---
title: "Lab 5 Key"
output: html_document
---

##Part A

**A1.** Explain each of the variables and parameters (C, M, D, t, x) in the one dimensional diffusion equation, including general unit of measurement (i.e. units of mass, units of length, etc). (5%)

Parameters:
```{r}
M= 10 
D= 0.05 
```
Variables: 
```{r}
x=seq(0,2,.5)
Time=c(1,10,100,1000) 
C=matrix(NA,5,4) 
```

**A2.** Fill in the values in your data table using the above equation. Hint: you will want to loop over both time and distance.
```{r}

```

**A3.**  What are the correct units for the concentrations you calculated?


**A4.**  Using your data table, create two graphs. Include your graphs in your report.

 a.	Concentration vs. distance for each of the time periods.
 
```{r}

```
 
 b.	Concentration vs. time for each of the distances. 
	Hint: you’ll want to include log=‘x’ as an argument to plot

```{r}

```

**A5.**  Do the graphs look reasonable? Support your answer with the general trend(s) from each graph. Be sure to describe behavior at the extremes (i.e. highest/lowest times and distances).


##Part B

B1.  Calculate the fluxes

1.	Create a new sequence of time values that are now evenly spaced from time t=0 to t=1000 seconds with a time step dt = 1 sec. Create a new matrix of all zeros to store this larger set of Concentrations.

2.	Initialize the value in the first row & first column (t=0, x=0) with the Concentration of pollutant released into the tube. Hint: you will need to convert the Mass released into the concentration in that grid cell.

3.	Set up a *for* loop over time, and then within this loop set up a second *for* loop over distance

4.	Within this double loop:
  4.1.	Calculate the *rate* of flux between each grid cell. Assume that there is no flux in or out at the ends of the tube. Hints: 1) don’t forget that the flux will occur in *both* directions. 2) This can be easier to implement if you calculate the gross fluxes in each direction explicitly, rather than the net flux. 3) don't forget about the boundary conditions - this could be handled with two if/else statements, one for when you're at the right boundary and the second for when you're at the left boundary.
  4.2.	Given the *rate* of flux, calculate the *amount* of pollutant that moves from one grid cell to the next over the specified **dt** and **dx**.
  4.3.	Calculate the new Concentration at the next time step given the Concentration currently in each grid cell *plus* the fluxes into the cell *minus* the fluxes out of the cell. Hint: don’t double count fluxes — the flux out of one cell *is* the flux into it’s neighbor .

```{r}
#step 1
dt=1 #1 sec grid size
nt=1000 #1000 time steps
time=seq(0,nt,dt)

#x still as before
dx=.5 #.5 cm grid size
nx=5
x=seq(0,2,dx)

Conc=matrix(0,length(x),length(time))

#step 2
#initialize
#grid cell is 1 sec by .5 cm
Conc[1,1]=M/.5

#step 3-4
#looping over time and space
for(t in 1:nt){
  for(i in 1:nx){
    
    if(i==1){
      Flux.to.left = 0
      Flux.to.right   = D*Conc[i,t] 
      Flux.from.left  = 0
      Flux.from.right = D*Conc[i+1,t]
    }else{
      if(i==nx){
        Flux.to.left = D*Conc[i,t]
        Flux.to.right   = 0 
        Flux.from.left  = D*Conc[i-1,t]
        Flux.from.right = 0
      }else{
        Flux.to.left    = D*Conc[i,t] # half flux out
        Flux.to.right   = D*Conc[i,t] # half flux out
        Flux.from.left  = D*Conc[i-1,t]
        Flux.from.right = D*Conc[i+1,t]
      }
    }
    
    Conc[i,t+1] = Conc[i,t] + 
      (Flux.from.left + Flux.from.right)*dt/dx -
      (Flux.to.left + Flux.to.right)*dt/dx
  }
}
```

**B2.** Create graphs equivalent to those in A4. 

Concentration vs distance at the times t = 1, 10, 100, and 1000.

```{r}
plot(x,Conc[,2],type="b",ylab="Concentration (g/cm)",xlab="Position (cm)")
for(i in 2:4){
  lines(x,Conc[,Time[i]+1],col=i,type="b")
}
legend("topright",paste(Time,"s"),col=1:4,lty=1)
```

Concentration vs time at all locations.

```{r}
plot(time,Conc[1,],type="l",ylab="Concentration (g/cm)",xlab="Time (s)",ylim=c(0,20),log="x")
for(i in 2:5){
  lines(time,Conc[i,],col=i)
}
legend("topright",paste(x,"cm"),col=1:5,lty=1)
```

**B3.** Create graphs that contain both the infinite tube calculation (Part A) and the finite tube calculations (Part B). To keep the number of lines from getting out of hand, only include 2 times in the Concentration vs distance plot and 2 distances in the Concentration vs time plot. (10)
```{r}
plot(x,C[,1],type="l",ylab="Concentration (g/cm)",xlab="Position (cm)")
lines(x,C[,4],col=4)
lines(x,Conc[,2],lty=2)
lines(x,Conc[,1001],lty=2,col=4)
legend("topright",lty=c(1:2,NA,NA),col=c(1,1,1,4),pch=c(NA,NA,19,19),c("Infinite","Finite","10 s","1000 s"))

plot(Time,C[1,],type="l",ylab="Concentration (g/cm)",xlab="Time (s)",log="x")
lines(Time,C[5,],col=5)
lines(time,Conc[1,],lty=2)
lines(time,Conc[5,],lty=2,col=5)
legend("topright",lty=c(1:2,NA,NA),col=c(1,1,1,5),pch=c(NA,NA,19,19),c("Infinite","Finite","0 cm","2 cm"))

```

**B4.** Describe and explain the differences between these plots and how they evolve over time and space.
